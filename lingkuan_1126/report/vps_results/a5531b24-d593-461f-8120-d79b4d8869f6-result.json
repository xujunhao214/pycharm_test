{"name": "云策略查询校验", "status": "broken", "statusDetails": {"message": "AttributeError: 'TestVPSquerylog' object has no attribute '_record_request_time'", "trace": "self = <lingkuan_1126.test_vps.test_lianxi.TestVPSquery.TestVPSquerylog object at 0x0000017DC61B99D0>\nvar_manager = <lingkuan_1126.commons.variable_manager.VariableManager object at 0x0000017DC61DB0A0>\nlogged_session = <lingkuan_1126.commons.session.EnvironmentSession object at 0x0000017DC61DB0D0>\ndb_transaction = <DBUtils.PooledDB.PooledDedicatedDBConnection object at 0x0000017DC62A9D90>\n\n    @pytest.mark.url(\"vps\")\n    @allure.title(\"云策略查询校验\")\n    def test_query_cloudId(self, var_manager, logged_session, db_transaction):\n        with allure.step(f\"0. 提取云策略ID\"):\n            dbcloud_data = self.query_database(\n                db_transaction,\n                f\"SELECT * FROM follow_cloud_master WHERE name = %s\",\n                (\"xjh测试策略\",)\n            )\n            cloud_id = dbcloud_data[0]['id']\n            # cloud_id = 106\n        with allure.step(f\"1. 发送查询请求\"):\n            json_data = {\n                \"page\": 1,\n                \"limit\": 100,\n                \"platformType\": [],\n                \"startDate\": DATETIME_INIT,\n                \"endDate\": get_current_time(),\n                \"keywords\": [],\n                \"logInfo\": [],\n                \"cloudId\": [cloud_id],\n                \"vpsId\": [],\n                \"logType\": [],\n                \"source\": []\n            }\n    \n>           response = self.send_post_request(\n                logged_session,\n                '/subcontrol/eslog/queryLogsPage',\n                json_data=json_data\n            )\n\ntest_vps\\test_lianxi.py:212: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <lingkuan_1126.test_vps.test_lianxi.TestVPSquery.TestVPSquerylog object at 0x0000017DC61B99D0>\nlogged_session = <lingkuan_1126.commons.session.EnvironmentSession object at 0x0000017DC61DB0D0>\nurl = '/subcontrol/eslog/queryLogsPage'\njson_data = {'cloudId': [106], 'endDate': '2025-11-27 17:07:01', 'keywords': [], 'limit': 100, ...}\ndata = None, files = None, sleep_seconds = 1\n\n    def send_post_request(self, logged_session, url, json_data=None, data=None, files=None,\n                          sleep_seconds=SLEEP_SECONDS):\n        \"\"\"发送POST请求（新增耗时统计，先统计再等待）\"\"\"\n        method = \"POST\"\n        with allure.step(f\"执行 {method} 请求\"):\n            try:\n                self._attach_request_details(\n                    method=method,\n                    url=url,\n                    headers=logged_session.headers,\n                    body=json_data if json_data else data,\n                    is_json=bool(json_data),\n                )\n    \n                # 1. 记录请求开始时间（核心：在发送请求前计时）\n                start_time = time.perf_counter()\n    \n                # 2. 发送请求（原有逻辑不变）\n                if files:\n                    response = logged_session.post(url, data=data, files=files)\n                    logger.info(f\"[{self._get_current_time()}] POST请求（带文件）: {url} \\n表单数据: {data}\")\n                elif json_data:\n                    response = logged_session.post(url, json=json_data)\n                    logger.info(f\"[{self._get_current_time()}] POST请求（JSON）: {url} \\n数据: {json_data}\")\n                else:\n                    response = logged_session.post(url, data=data)\n                    logger.info(f\"[{self._get_current_time()}] POST请求（表单）: {url} \\n数据: {data}\")\n    \n                # 3. 记录并展示耗时（核心：响应接收后立即统计，不含等待）\n>               self._record_request_time(method, url, start_time)\nE               AttributeError: 'TestVPSquerylog' object has no attribute '_record_request_time'\n\ncommons\\api_base.py:342: AttributeError"}, "steps": [{"name": "0. 提取云策略ID", "status": "passed", "steps": [{"name": "执行数据库查询", "status": "passed", "steps": [{"name": "数据库查询结果", "status": "passed", "attachments": [{"name": "查询结果（共1条，显示前50条）", "source": "7e78d7c9-8b06-4e12-93c9-4f9fd59baa74-attachment.json", "type": "application/json"}, {"name": "执行SQL", "source": "abc19c78-c483-47cd-bcaa-dfcb57c12a11-attachment.txt", "type": "text/plain"}, {"name": "SQL参数", "source": "2fa57b95-3f7b-4815-aecb-0b4f0b566dd2-attachment.txt", "type": "text/plain"}], "start": 1764234421995, "stop": 1764234421996}], "start": 1764234421950, "stop": 1764234421996}], "start": 1764234421950, "stop": 1764234421996}, {"name": "1. 发送查询请求", "status": "broken", "statusDetails": {"message": "AttributeError: 'TestVPSquerylog' object has no attribute '_record_request_time'\n", "trace": "  File \"D:\\pycharm_test\\lingkuan_1126\\test_vps\\test_lianxi.py\", line 212, in test_query_cloudId\n    response = self.send_post_request(\n  File \"D:\\pycharm_test\\lingkuan_1126\\commons\\api_base.py\", line 342, in send_post_request\n    self._record_request_time(method, url, start_time)\n"}, "steps": [{"name": "执行 POST 请求", "status": "broken", "statusDetails": {"message": "AttributeError: 'TestVPSquerylog' object has no attribute '_record_request_time'\n", "trace": "  File \"D:\\pycharm_test\\lingkuan_1126\\commons\\api_base.py\", line 342, in send_post_request\n    self._record_request_time(method, url, start_time)\n"}, "steps": [{"name": "请求详情", "status": "passed", "attachments": [{"name": "请求URL", "source": "756d4b69-4f03-4963-a1c5-514c16ba0ed4-attachment.txt", "type": "text/plain"}, {"name": "请求头", "source": "fd9033e6-6d3c-4e76-adf6-6c8ee0bc0502-attachment.json", "type": "application/json"}, {"name": "请求体（JSON）", "source": "d2e5c066-f7e0-4a4b-a5b9-c962d51aaefd-attachment.json", "type": "application/json"}], "start": 1764234421997, "stop": 1764234421998}], "start": 1764234421997, "stop": 1764234423501}], "start": 1764234421996, "stop": 1764234423501}], "attachments": [{"name": "log", "source": "194e9582-3709-4ff3-8534-feb7a035d6a0-attachment.txt", "type": "text/plain"}], "start": 1764234421950, "stop": 1764234423502, "uuid": "03bc44a4-095f-4e12-b591-1a0d20d7052f", "historyId": "1df2e9bb834766cf4a47b61d60f43b7d", "testCaseId": "1df2e9bb834766cf4a47b61d60f43b7d", "fullName": "test_vps.test_lianxi.TestVPSquerylog#test_query_cloudId", "labels": [{"name": "feature", "value": "VPS看板-查询校验"}, {"name": "story", "value": "VPS看板-日志查询"}, {"name": "tag", "value": "url('vps')"}, {"name": "parentSuite", "value": "test_vps"}, {"name": "suite", "value": "test_lianxi"}, {"name": "subSuite", "value": "TestVPSquery"}, {"name": "host", "value": "DESKTOP-4S9CU1E"}, {"name": "thread", "value": "72640-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_vps.test_lianxi"}]}