DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /OrderClose?id=96151315-f78e-4a68-be25-28182f52fcb8&ticket=86438056&price=0.00 HTTP/11" 201 2263
INFO     root:test_oac_proportion.py:4657 第1次平仓响应: {'message': 'Client with id = 96151315-f78e-4a68-be25-28182f52fcb8 not found. Please use /Connect to create new token. Headers = Content-Type : application/json___Accept : */*___Accept-Encoding : gzip, deflate___Authorization : e5f9f574-fd0a-42bd-904b-3a7a088de27e___Host : mt4.mtapi.io___User-Agent : Apifox/1.0.0 (https://apifox.com)___x-sign : 417B110F1E71BD2CFE96366E67849B0B___x-forwarded-for : 14.153.94.232___x-forwarded-proto : https___x-envoy-external-address : 14.153.94.232___x-request-id : 62283b80-59c7-9b43-a507-b5dff0e4c77d___x-envoy-decorator-operation : mt4resttrial.rest.svc.cluster.local:8050/*___x-envoy-peer-metadata : ChQKDkFQUF9DT05UQUlORVJTEgIaAAoaCgpDTFVTVEVSX0lEEgwaCkt1YmVybmV0ZXMKHQoMSU5TVEFOQ0VfSVBTEg0aCzEwLjEuNTguMjIwChkKDUlTVElPX1ZFUlNJT04SCBoGMS4xOC4yCpwDCgZMQUJFTFMSkQMqjgMKHQoDYXBwEhYaFGlzdGlvLWluZ3Jlc3NnYXRld2F5ChMKBWNoYXJ0EgoaCGdhdGV3YXlzChQKCGhlcml0YWdlEggaBlRpbGxlcgo2CilpbnN0YWxsLm9wZXJhdG9yLmlzdGlvLmlvL293bmluZy1yZXNvdXJjZRIJGgd1bmtub3duChkKBWlzdGlvEhAaDmluZ3Jlc3NnYXRld2F5ChkKDGlzdGlvLmlvL3JldhIJGgdkZWZhdWx0CjAKG29wZXJhdG9yLmlzdGlvLmlvL2NvbXBvbmVudBIRGg9JbmdyZXNzR2F0ZXdheXMKEgoHcmVsZWFzZRIHGgVpc3Rpbwo5Ch9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEhYaFGlzdGlvLWluZ3Jlc3NnYXRld2F5Ci8KI3NlcnZpY2UuaXN0aW8uaW8vY2Fub25pY2FsLXJldmlzaW9uEggaBmxhdGVzdAoiChdzaWRlY2FyLmlzdGlvLmlvL2luamVjdBIHGgVmYWxzZQoaCgdNRVNIX0lEEg8aDWNsdXN0ZXIubG9jYWwKLwoETkFNRRInGiVpc3Rpby1pbmdyZXNzZ2F0ZXdheS02OWM2OGI2Y2Q1LXI2d3drChsKCU5BTUVTUEFDRRIOGgxpc3Rpby1zeXN0ZW0KXQoFT1dORVISVBpSa3ViZXJuZXRlczovL2FwaXMvYXBwcy92MS9uYW1lc3BhY2VzL2lzdGlvLXN5c3RlbS9kZXBsb3ltZW50cy9pc3Rpby1pbmdyZXNzZ2F0ZXdheQoXChFQTEFURk9STV9NRVRBREFUQRICKgAKJwoNV09SS0xPQURfTkFNRRIWGhRpc3Rpby1pbmdyZXNzZ2F0ZXdheQ==___x-envoy-peer-metadata-id : router~10.1.58.220~istio-ingressgateway-69c68b6cd5-r6wwk.istio-system~istio-system.svc.cluster.local___x-envoy-attempt-count : 1___x-b3-traceid : 8b01e6a88287e694d4d7b4c1c37e0f8a___x-b3-spanid : d4d7b4c1c37e0f8a___x-b3-sampled : 1___', 'code': 'INVALID_TOKEN', 'stackTrace': '   at mtrestapi.MyControllerBase.GetClient(String id, String method) in /src/mt4rest/MyControllerBase.cs:line 75\n   at mtrestapi.Trading.OrderClose(String id, Int32 ticket, Double lots, Double price, Int32 slippage) in /src/mt4rest/Controllers/Trading.cs:line 261'}
WARNING  root:test_oac_proportion.py:4677 第1次平仓失败，未获取到平仓订单号
INFO     root:test_oac_proportion.py:4684 将在10秒后进行第2次尝试...
DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /Connect?user=301390786&password=lrd1lff&host=185.96.247.214&port=2333&connectTimeoutSeconds=30 HTTP/11" 201 595
INFO     root:test_oac_proportion.py:4002 第1次登录尝试 - 响应内容: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
WARNING  root:test_oac_proportion.py:4010 第1次尝试失败 - 无效的token格式: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
INFO     root:test_oac_proportion.py:4017 将在5秒后进行第2次重试...
DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /Connect?user=301390786&password=lrd1lff&host=185.96.247.214&port=2333&connectTimeoutSeconds=30 HTTP/11" 200 None
INFO     root:test_oac_proportion.py:4002 第2次登录尝试 - 响应内容: 96151315-f78e-4a68-be25-28182f52fcb8
INFO     root:test_oac_proportion.py:4007 第2次尝试成功 - 获取到token: 96151315-f78e-4a68-be25-28182f52fcb8
INFO     root:test_oac_proportion.py:4026 登录MT4账号获取token: 96151315-f78e-4a68-be25-28182f52fcb8
DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /OrderClose?id=96151315-f78e-4a68-be25-28182f52fcb8&ticket=86438056&price=0.00 HTTP/11" 200 915
INFO     root:test_oac_proportion.py:4657 第2次平仓响应: {'ticket': 86438056, 'openTime': '2025-09-22T12:53:49', 'closeTime': '2025-09-22T12:57:29', 'expiration': '1970-01-01T00:00:00', 'type': 'Buy', 'lots': 0.2, 'symbol': 'XAUUSD', 'openPrice': 3724.31, 'stopLoss': 0.0, 'takeProfit': 0.0, 'closePrice': 3724.11, 'magicNumber': 0, 'swap': 0.0, 'commission': 0.0, 'comment': '', 'profit': -4.0, 'rateOpen': 1.0, 'rateClose': 1.0, 'rateMargin': 1.0, 'ex': {'order': 86438056, 'login': 301390786, 'symbol': 'WEFVVVNEAAAAAAAA', 'digits': 2, 'cmd': 0, 'volume': 20, 'open_time': 1758545629, 'state': 3, 'open_price': 3724.31, 'sl': 0.0, 'tp': 0.0, 'close_time': 1758545849, 'value_date': 0, 'expiration': 0, 'place_type': 0, 'conv_rates': [1.0, 1.0], 'commission': 0.0, 'commission_agent': 0.0, 'storage': 0.0, 'close_price': 3724.11, 'profit': -4.0, 'taxes': 0.0, 'magic': 0, 'comment': '', 'internal_id': 0, 'activation': 0, 'spread': 0, 'margin_rate': 1.0, 'timestamp': 1758545849, 'reserved': [0, 0, 0, 0], 'next': 0}, 'placedType': 'Client', 'state': 'CLOSED_NORMAL', 'digits': 2}
INFO     root:api_base.py:1363 校验通过: 预期：开仓订单号和平仓订单号一致

实际: 86438056
操作: ==
预期: 86438056

INFO     template.commons.api_base:test_oac_proportion.py:4673 开仓订单号和平仓订单号一致,开仓订单号：86438056 平仓订单号：86438056