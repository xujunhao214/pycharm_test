DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /OrderClose?id=5fc8d7cb-b427-487d-9055-775b4ed7893b&ticket=44299362&price=0.00 HTTP/11" 201 2263
INFO     root:test_oac_proportion.py:4020 第1次平仓响应: {'message': 'Client with id = 5fc8d7cb-b427-487d-9055-775b4ed7893b not found. Please use /Connect to create new token. Headers = Content-Type : application/json___Accept : */*___Accept-Encoding : gzip, deflate___Authorization : e5f9f574-fd0a-42bd-904b-3a7a088de27e___Host : mt4.mtapi.io___User-Agent : Apifox/1.0.0 (https://apifox.com)___x-sign : 417B110F1E71BD2CFE96366E67849B0B___x-forwarded-for : 14.153.94.232___x-forwarded-proto : https___x-envoy-external-address : 14.153.94.232___x-request-id : 613aeb5f-86f7-9fbe-ba38-f08aa5c6e4e3___x-envoy-decorator-operation : mt4resttrial.rest.svc.cluster.local:8050/*___x-envoy-peer-metadata : ChQKDkFQUF9DT05UQUlORVJTEgIaAAoaCgpDTFVTVEVSX0lEEgwaCkt1YmVybmV0ZXMKHQoMSU5TVEFOQ0VfSVBTEg0aCzEwLjEuNTguMjIwChkKDUlTVElPX1ZFUlNJT04SCBoGMS4xOC4yCpwDCgZMQUJFTFMSkQMqjgMKHQoDYXBwEhYaFGlzdGlvLWluZ3Jlc3NnYXRld2F5ChMKBWNoYXJ0EgoaCGdhdGV3YXlzChQKCGhlcml0YWdlEggaBlRpbGxlcgo2CilpbnN0YWxsLm9wZXJhdG9yLmlzdGlvLmlvL293bmluZy1yZXNvdXJjZRIJGgd1bmtub3duChkKBWlzdGlvEhAaDmluZ3Jlc3NnYXRld2F5ChkKDGlzdGlvLmlvL3JldhIJGgdkZWZhdWx0CjAKG29wZXJhdG9yLmlzdGlvLmlvL2NvbXBvbmVudBIRGg9JbmdyZXNzR2F0ZXdheXMKEgoHcmVsZWFzZRIHGgVpc3Rpbwo5Ch9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEhYaFGlzdGlvLWluZ3Jlc3NnYXRld2F5Ci8KI3NlcnZpY2UuaXN0aW8uaW8vY2Fub25pY2FsLXJldmlzaW9uEggaBmxhdGVzdAoiChdzaWRlY2FyLmlzdGlvLmlvL2luamVjdBIHGgVmYWxzZQoaCgdNRVNIX0lEEg8aDWNsdXN0ZXIubG9jYWwKLwoETkFNRRInGiVpc3Rpby1pbmdyZXNzZ2F0ZXdheS02OWM2OGI2Y2Q1LXI2d3drChsKCU5BTUVTUEFDRRIOGgxpc3Rpby1zeXN0ZW0KXQoFT1dORVISVBpSa3ViZXJuZXRlczovL2FwaXMvYXBwcy92MS9uYW1lc3BhY2VzL2lzdGlvLXN5c3RlbS9kZXBsb3ltZW50cy9pc3Rpby1pbmdyZXNzZ2F0ZXdheQoXChFQTEFURk9STV9NRVRBREFUQRICKgAKJwoNV09SS0xPQURfTkFNRRIWGhRpc3Rpby1pbmdyZXNzZ2F0ZXdheQ==___x-envoy-peer-metadata-id : router~10.1.58.220~istio-ingressgateway-69c68b6cd5-r6wwk.istio-system~istio-system.svc.cluster.local___x-envoy-attempt-count : 1___x-b3-traceid : 7ff5fe9c7a0de97567b2fad136eb1b54___x-b3-spanid : 67b2fad136eb1b54___x-b3-sampled : 1___', 'code': 'INVALID_TOKEN', 'stackTrace': '   at mtrestapi.MyControllerBase.GetClient(String id, String method) in /src/mt4rest/MyControllerBase.cs:line 75\n   at mtrestapi.Trading.OrderClose(String id, Int32 ticket, Double lots, Double price, Int32 slippage) in /src/mt4rest/Controllers/Trading.cs:line 261'}
WARNING  root:test_oac_proportion.py:4040 第1次平仓失败，未获取到平仓订单号
INFO     root:test_oac_proportion.py:4047 将在10秒后进行第2次尝试...
DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /Connect?user=2088767545&password=j7gdppb&host=acymt4demo01dns01.dnslogix.com&port=443&connectTimeoutSeconds=30 HTTP/11" 201 595
INFO     root:test_oac_proportion.py:3365 第1次登录尝试 - 响应内容: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
WARNING  root:test_oac_proportion.py:3373 第1次尝试失败 - 无效的token格式: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
INFO     root:test_oac_proportion.py:3380 将在5秒后进行第2次重试...
DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /Connect?user=2088767545&password=j7gdppb&host=acymt4demo01dns01.dnslogix.com&port=443&connectTimeoutSeconds=30 HTTP/11" 201 595
INFO     root:test_oac_proportion.py:3365 第2次登录尝试 - 响应内容: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
WARNING  root:test_oac_proportion.py:3373 第2次尝试失败 - 无效的token格式: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
INFO     root:test_oac_proportion.py:3380 将在5秒后进行第3次重试...
DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /Connect?user=2088767545&password=j7gdppb&host=acymt4demo01dns01.dnslogix.com&port=443&connectTimeoutSeconds=30 HTTP/11" 200 None
INFO     root:test_oac_proportion.py:3365 第3次登录尝试 - 响应内容: 5fc8d7cb-b427-487d-9055-775b4ed7893b
INFO     root:test_oac_proportion.py:3370 第3次尝试成功 - 获取到token: 5fc8d7cb-b427-487d-9055-775b4ed7893b
INFO     root:test_oac_proportion.py:3389 登录MT4账号获取token: 5fc8d7cb-b427-487d-9055-775b4ed7893b
DEBUG    urllib3.connectionpool:connectionpool.py:1051 Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    urllib3.connectionpool:connectionpool.py:546 https://mt4.mtapi.io:443 "GET /OrderClose?id=5fc8d7cb-b427-487d-9055-775b4ed7893b&ticket=44299362&price=0.00 HTTP/11" 200 984
INFO     root:test_oac_proportion.py:4020 第2次平仓响应: {'ticket': 44299362, 'openTime': '2025-09-22T04:29:11', 'closeTime': '2025-09-22T04:32:12', 'expiration': '1970-01-01T00:00:00', 'type': 'Buy', 'lots': 0.2, 'symbol': 'XAUUSDzero', 'openPrice': 3690.9, 'stopLoss': 0.0, 'takeProfit': 0.0, 'closePrice': 3690.42, 'magicNumber': 0, 'swap': 0.0, 'commission': -130.0, 'comment': '', 'profit': -1423.0, 'rateOpen': 546785.39201, 'rateClose': 546899.2488350001, 'rateMargin': 148.147, 'ex': {'order': 44299362, 'login': 2088767545, 'symbol': 'WEFVVVNEemVybwAA', 'digits': 2, 'cmd': 0, 'volume': 20, 'open_time': 1758515351, 'state': 3, 'open_price': 3690.9, 'sl': 0.0, 'tp': 0.0, 'close_time': 1758515532, 'value_date': 0, 'expiration': 0, 'place_type': 0, 'conv_rates': [546785.39201, 546899.2488350001], 'commission': -130.0, 'commission_agent': 0.0, 'storage': 0.0, 'close_price': 3690.42, 'profit': -1423.0, 'taxes': 0.0, 'magic': 0, 'comment': '', 'internal_id': 0, 'activation': 0, 'spread': 0, 'margin_rate': 148.147, 'timestamp': 1758515532, 'reserved': [0, 0, 0, 0], 'next': 0}, 'placedType': 'Client', 'state': 'CLOSED_NORMAL', 'digits': 2}
INFO     root:api_base.py:1363 校验通过: 预期：开仓订单号和平仓订单号一致

实际: 44299362
操作: ==
预期: 44299362

INFO     template.commons.api_base:test_oac_proportion.py:4036 开仓订单号和平仓订单号一致,开仓订单号：44299362 平仓订单号：44299362