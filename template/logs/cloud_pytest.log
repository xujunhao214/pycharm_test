INFO     - 2025-09-23 11:53:15 - [conftest:344] - [2025-09-23 11:53:15] 测试会话开始: 2025-09-23 11:53:15, 测试组: cloud
INFO     - 2025-09-23 11:53:15 - [variable_manager:40] - [2025-09-23 11:53:15] 成功加载静态变量: VAR\uat_data.json
INFO     - 2025-09-23 11:53:15 - [variable_manager:64] - [2025-09-23 11:53:15] 成功加载运行时变量: VAR\runtime_vars_cloud.json
DEBUG    - 2025-09-23 11:53:15 - [connectionpool:1051] - Starting new HTTPS connection (1): dev.lgcopytrade.top:443
DEBUG    - 2025-09-23 11:53:16 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "POST /api/sys/mLogin HTTP/11" 200 None
INFO     - 2025-09-23 11:53:16 - [test_proportion_public:45] - 登录返回信息：{"success":true,"message":"","code":200,"result":{"userInfo":{"id":"1962808746181640193","username":"xujunhao@163.com","realname":"徐","avatar":"https://followork.oss-cn-zhangjiakou.aliyuncs.com/saas/huichuang/img/default_avatar.png","agentIds":"e9ca23d68d884d4ebb19d07889727dae","birthday":null,"sex":1,"email":"xujunhao@163.com","phone":"1541561456156","orgCode":"A01","orgCodeTxt":null,"status":1,"delFlag":0,"workNo":null,"post":"employee","telephone":null,"createBy":"huangssj168@163.com","createTime":"2025-09-02 17:24:07","updateBy":"xujunhao@163.com","updateTime":"2025-09-10 14:03:13","activitiSync":1,"userIdentity":1,"departIds":"","relTenantIds":"","clientId":null,"country":null,"countryCode":"CN","countryName":"中国","invitationCode":"10595","agentLevel":"1767396755533766658","agentLevelLocking":true,"agentLeader":false,"address":null,"certificateType":null,"certificateNumber":null,"certificatePic":null,"introduce":null,"nickname":"徐","mt4Role":"MASTER_REAL,SLAVE_REAL","cashoutLimitDays":2,"updateAgentTime":"2025-09-10 09:54:38","whiteLabelId":null,"whiteLabelNameEn":null,"isMfaVerified":null,"lang":0,"trialPeriod":-14,"bufferDay":-6,"bufferStartTime":"2025-09-12 17:27:08","bufferEndTime":"2025-09-15 17:27:08"},"token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3NTkyMDQzOTUsInVzZXJuYW1lIjoieHVqdW5oYW9AMTYzLmNvbSJ9.koZTPDP6FyautOaXcYAPU1MlZeuAXm0IT1MS9xYDP4w"},"timestamp":1758599595366}
INFO     - 2025-09-23 11:53:16 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
DEBUG    - 2025-09-23 11:53:16 - [connectionpool:1051] - Starting new HTTPS connection (1): dev.lgcopytrade.top:443
DEBUG    - 2025-09-23 11:53:17 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/blockchain/account/closeAllOrder?traderId=1970043654163542017&including=true HTTP/11" 200 None
INFO     - 2025-09-23 11:53:17 - [test_proportion_public:78] - 平仓返回信息：{"success":true,"message":"平仓信号发送成功……","code":0,"result":true,"timestamp":1758599596278}
DEBUG    - 2025-09-23 11:53:17 - [connectionpool:1051] - Starting new HTTPS connection (1): dev.lgcopytrade.top:443
DEBUG    - 2025-09-23 11:53:18 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/blockchain/account/closeAllOrder?traderId=1970043805108154370&including=true HTTP/11" 200 None
INFO     - 2025-09-23 11:53:18 - [test_proportion_public:97] - 平仓返回信息：{"success":true,"message":"平仓信号发送成功……","code":0,"result":true,"timestamp":1758599597179}
INFO     - 2025-09-23 11:53:18 - [conftest:74] - [2025-09-23 11:53:18] 用例  开始登录，环境: uat
DEBUG    - 2025-09-23 11:53:18 - [connectionpool:1051] - Starting new HTTPS connection (1): dev.lgcopytrade.top:443
DEBUG    - 2025-09-23 11:53:19 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/sys/randomImage/1758599598526?_t=1758599598 HTTP/11" 200 None
INFO     - 2025-09-23 11:53:19 - [conftest:143] - 第1次尝试 - 验证码识别结果: RSkj
DEBUG    - 2025-09-23 11:53:20 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "POST /api/sys/login HTTP/11" 200 None
INFO     - 2025-09-23 11:53:20 - [conftest:186] - uat环境登录成功（第1次尝试）
INFO     - 2025-09-23 11:53:20 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
DEBUG    - 2025-09-23 11:53:20 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/online/cgform/api/getData/402883977b38c9ca017b38c9caff0000?_t=1758599595&magic=301390786&column=id&order=desc&pageNo=1&pageSize=50&superQueryMatchType=and HTTP/11" 200 None
INFO     - 2025-09-23 11:53:20 - [api_base:257] - [2025-09-23 11:53:20] GET请求: /online/cgform/api/getData/402883977b38c9ca017b38c9caff0000 | 参数: {'_t': 1758599595, 'magic': '301390786', 'column': 'id', 'order': 'desc', 'pageNo': 1, 'pageSize': 50, 'superQueryMatchType': 'and'}
DEBUG    - 2025-09-23 11:53:24 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/online/cgform/api/getData/402883977b38c9ca017b38c9caff0000?_t=1758599595&trader_id=1970043654163542017&column=id&order=desc&pageNo=1&pageSize=50&superQueryMatchType=and HTTP/11" 200 None
INFO     - 2025-09-23 11:53:24 - [api_base:257] - [2025-09-23 11:53:24] GET请求: /online/cgform/api/getData/402883977b38c9ca017b38c9caff0000 | 参数: {'_t': 1758599595, 'trader_id': '1970043654163542017', 'column': 'id', 'order': 'desc', 'pageNo': 1, 'pageSize': 50, 'superQueryMatchType': 'and'}
DEBUG    - 2025-09-23 11:53:27 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "PUT /api/blockchain/master-slave/editPa HTTP/11" 200 None
INFO     - 2025-09-23 11:53:27 - [api_base:339] - [2025-09-23 11:53:27] PUT请求: /blockchain/master-slave/editPa | 数据: {'id': '1970043908604809217', 'direction': 'FORWARD', 'followingMode': 2, 'fixedProportion': 100, 'fixedLots': None}
DEBUG    - 2025-09-23 11:53:31 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/online/cgreport/api/getColumnsAndData/1560189381093109761?_t=1758599595&account=301390787&pageNo=1&pageSize=20&status=NORMAL%2CAUDIT HTTP/11" 200 None
INFO     - 2025-09-23 11:53:31 - [api_base:257] - [2025-09-23 11:53:31] GET请求: /online/cgreport/api/getColumnsAndData/1560189381093109761 | 参数: {'_t': 1758599595, 'account': '301390787', 'pageNo': '1', 'pageSize': '20', 'status': 'NORMAL,AUDIT'}
INFO     - 2025-09-23 11:53:34 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
DEBUG    - 2025-09-23 11:53:34 - [connectionpool:1051] - Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    - 2025-09-23 11:54:07 - [connectionpool:546] - https://mt4.mtapi.io:443 "GET /Connect?user=301390786&password=lrd1lff&host=185.96.247.214&port=2333&connectTimeoutSeconds=30 HTTP/11" 201 595
INFO     - 2025-09-23 11:54:07 - [test_proportion_public:288] - 第1次登录尝试 - 响应内容: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
WARNING  - 2025-09-23 11:54:07 - [test_proportion_public:296] - 第1次尝试失败 - 无效的token格式: {"message":"Not connected in 30000 ms: Starting thread, thread start called","code":"TIMEOUT","stackTrace":"   at TradingAPI.MT4Server.QuoteClient.Connect()\n   at mtrestapi.Connection.ConnectRestore(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds) in /src/mt4rest/Controllers/Connection.cs:line 314\n   at mtrestapi.Connection.Connect(Int32 user, String password, String host, Int32 port, String id, String hardwareId, Int32 connectTimeoutSeconds, Boolean downloadOrderHistory) in /src/mt4rest/Controllers/Connection.cs:line 224"}
INFO     - 2025-09-23 11:54:07 - [test_proportion_public:303] - 将在5秒后进行第2次重试...
DEBUG    - 2025-09-23 11:54:12 - [connectionpool:1051] - Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    - 2025-09-23 11:54:21 - [connectionpool:546] - https://mt4.mtapi.io:443 "GET /Connect?user=301390786&password=lrd1lff&host=185.96.247.214&port=2333&connectTimeoutSeconds=30 HTTP/11" 200 None
INFO     - 2025-09-23 11:54:21 - [test_proportion_public:288] - 第2次登录尝试 - 响应内容: 96151315-f78e-4a68-be25-28182f52fcb8
INFO     - 2025-09-23 11:54:21 - [test_proportion_public:293] - 第2次尝试成功 - 获取到token: 96151315-f78e-4a68-be25-28182f52fcb8
INFO     - 2025-09-23 11:54:21 - [test_proportion_public:312] - 登录MT4账号获取token: 96151315-f78e-4a68-be25-28182f52fcb8
DEBUG    - 2025-09-23 11:54:21 - [connectionpool:1051] - Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    - 2025-09-23 11:54:23 - [connectionpool:546] - https://mt4.mtapi.io:443 "GET /OrderSend?id=96151315-f78e-4a68-be25-28182f52fcb8&symbol=XAUUSD&operation=Buy&volume=0.01&placedType=Client&price=0.00 HTTP/11" 200 906
INFO     - 2025-09-23 11:54:23 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
INFO     - 2025-09-23 11:54:23 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
INFO     - 2025-09-23 11:54:23 - [test_proportion_public:328] - ticket: 86527006,lots_open:0.01
DEBUG    - 2025-09-23 11:54:23 - [connectionpool:1051] - Starting new HTTPS connection (1): mt4.mtapi.io:443
DEBUG    - 2025-09-23 11:54:24 - [connectionpool:546] - https://mt4.mtapi.io:443 "GET /OrderClose?id=96151315-f78e-4a68-be25-28182f52fcb8&ticket=86527006&price=0.00 HTTP/11" 200 917
INFO     - 2025-09-23 11:54:24 - [test_proportion_public:354] - 第1次平仓响应: {'ticket': 86527006, 'openTime': '2025-09-23T06:54:21', 'closeTime': '2025-09-23T06:54:23', 'expiration': '1970-01-01T00:00:00', 'type': 'Buy', 'lots': 0.01, 'symbol': 'XAUUSD', 'openPrice': 3746.14, 'stopLoss': 0.0, 'takeProfit': 0.0, 'closePrice': 3745.85, 'magicNumber': 0, 'swap': 0.0, 'commission': 0.0, 'comment': '', 'profit': -0.29, 'rateOpen': 1.0, 'rateClose': 1.0, 'rateMargin': 1.0, 'ex': {'order': 86527006, 'login': 301390786, 'symbol': 'WEFVVVNEAAAAAAAA', 'digits': 2, 'cmd': 0, 'volume': 1, 'open_time': 1758610461, 'state': 3, 'open_price': 3746.14, 'sl': 0.0, 'tp': 0.0, 'close_time': 1758610463, 'value_date': 0, 'expiration': 0, 'place_type': 0, 'conv_rates': [1.0, 1.0], 'commission': 0.0, 'commission_agent': 0.0, 'storage': 0.0, 'close_price': 3745.85, 'profit': -0.29, 'taxes': 0.0, 'magic': 0, 'comment': '', 'internal_id': 0, 'activation': 0, 'spread': 0, 'margin_rate': 1.0, 'timestamp': 1758610463, 'reserved': [0, 0, 0, 0], 'next': 0}, 'placedType': 'Client', 'state': 'CLOSED_NORMAL', 'digits': 2}
INFO     - 2025-09-23 11:54:24 - [api_base:1363] - 校验通过: 预期：开仓订单号和平仓订单号一致

实际: 86527006
操作: ==
预期: 86527006

INFO     - 2025-09-23 11:54:24 - [test_proportion_public:370] - 开仓订单号和平仓订单号一致,开仓订单号：86527006 平仓订单号：86527006
DEBUG    - 2025-09-23 11:54:25 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/online/cgform/api/getData/402883977b38c9ca017b38c9caff0000?_t=1758599595&trader_id=1970043654163542017&column=id&order=desc&pageNo=1&pageSize=50&superQueryMatchType=and HTTP/11" 200 None
INFO     - 2025-09-23 11:54:25 - [api_base:257] - [2025-09-23 11:54:25] GET请求: /online/cgform/api/getData/402883977b38c9ca017b38c9caff0000 | 参数: {'_t': 1758599595, 'trader_id': '1970043654163542017', 'column': 'id', 'order': 'desc', 'pageNo': 1, 'pageSize': 50, 'superQueryMatchType': 'and'}
INFO     - 2025-09-23 11:54:28 - [test_lianxi3:92] - 喊单者手数是: None
INFO     - 2025-09-23 11:54:28 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
INFO     - 2025-09-23 11:54:28 - [api_base:508] - [2025-09-23 11:54:28] 执行SQL: SELECT * FROM bchain_trader_subscribe_order WHERE master_ticket = %s ORDER BY create_time DESC 
参数: (86527006,)
INFO     - 2025-09-23 11:54:28 - [api_base:511] - [2025-09-23 11:54:28] 查询成功，结果数量: 1
INFO     - 2025-09-23 11:54:28 - [api_base:523] - [2025-09-23 11:54:28] 查询结果: [{"id": "1970335908302307329", "master_id": "1970043654163542017", "master_ticket": 86527006, "master_type": 0, "master_open_time": "2025-09-23 06:54:21", "detected_open_time": "2025-09-23 11:54:22", "master_close_time": "2025-09-23 06:54:23", "detected_close_time": "2025-09-23 11:54:23", "master_lots": 0.01, "comment": "", "master_profit": -0.29, "master_symbol": "XAUUSD", "slave_id": "1970043805108154370", "slave_ticket": 86527007, "slave_type": 0, "slave_open_time": "2025-09-23 11:54:22", "slave_receive_time": "2025-09-23 11:54:22", "slave_close_time": "2025-09-23 06:54:23", "slave_receive_close_time": "2025-09-23 11:54:23", "slave_lots": 0.01, "slave_position": null, "slave_profit": -0.29, "slave_open_price": null, "slave_symbol": "XAUUSD", "slave_comment": null, "following_mode": 2, "fixed_lots": null, "fixed_proportion": 100, "ratio": 1.0, "flag": 6, "direction": "FORWARD", "extra": "平仓成功", "delete_flag": 1, "award_status": null, "create_by": null, "create_time": "2025-09-23 11:54:22", "update_by": null, "update_time": "2025-09-23 11:54:27", "close_order_agent_id": "e9ca23d68d884d4ebb19d07889727dae", "master_or_slave": 0, "commission_status": 0, "open_order_agent_id": "e9ca23d68d884d4ebb19d07889727dae", "close_extra": null, "open_time_difference": 321, "close_time_difference": 331, "open_price_difference": 0.0, "close_price_difference": 0.0}]
INFO     - 2025-09-23 11:54:28 - [test_lianxi3:172] - 跟单账号订单号: 86527007
INFO     - 2025-09-23 11:54:28 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
INFO     - 2025-09-23 11:54:28 - [test_lianxi3:177] - 开仓时间差（毫秒）: 321
INFO     - 2025-09-23 11:54:28 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
DEBUG    - 2025-09-23 11:54:29 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/online/cgform/api/getData/402883977b38c9ca017b38c9caff0000?_t=1758599595&trader_id=1970043805108154370&column=id&order=desc&pageNo=1&pageSize=50&superQueryMatchType=and HTTP/11" 200 None
INFO     - 2025-09-23 11:54:29 - [api_base:257] - [2025-09-23 11:54:29] GET请求: /online/cgform/api/getData/402883977b38c9ca017b38c9caff0000 | 参数: {'_t': 1758599595, 'trader_id': '1970043805108154370', 'column': 'id', 'order': 'desc', 'pageNo': 1, 'pageSize': 50, 'superQueryMatchType': 'and'}
INFO     - 2025-09-23 11:54:32 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
DEBUG    - 2025-09-23 11:54:53 - [connectionpool:546] - https://dev.lgcopytrade.top:443 "GET /api/online/cgform/api/getData/402883977b38c9ca017b38c9caff0000?_t=1758599595&trader_id=1970043805108154370&column=id&order=desc&pageNo=1&pageSize=50&superQueryMatchType=and HTTP/11" 200 None
INFO     - 2025-09-23 11:54:53 - [api_base:257] - [2025-09-23 11:54:53] GET请求: /online/cgform/api/getData/402883977b38c9ca017b38c9caff0000 | 参数: {'_t': 1758599595, 'trader_id': '1970043805108154370', 'column': 'id', 'order': 'desc', 'pageNo': 1, 'pageSize': 50, 'superQueryMatchType': 'and'}
INFO     - 2025-09-23 11:54:56 - [variable_manager:111] - [2025-09-23 11:53:15] 运行时变量已保存到: D:\pycharm_test\template\VAR\runtime_vars_cloud.json
INFO     - 2025-09-23 11:55:01 - [conftest:371] - [2025-09-23 11:53:15] 测试会话结束，总耗时: 106.00秒
INFO     - 2025-09-23 11:55:01 - [feishu_notification:131] - [2025-09-23 11:53:15] 发送飞书消息，URL: https://open.feishu.cn/open-apis/bot/v2/hook/8d3475ac-8adc-45ed-97c7-0f0ec8647a4f
DEBUG    - 2025-09-23 11:55:01 - [connectionpool:1051] - Starting new HTTPS connection (1): open.feishu.cn:443
