{"name": "修改跟单账号（仅使用后6个数据与模板匹配）", "status": "failed", "statusDetails": {"message": "AssertionError: Failed: 账号6421响应异常（JSON断言失败）", "trace": "self = <lingkuan_1106.test_cloudTrader.test_create_scene.TestCreate_importcloudTrader object at 0x0000020B7F29F8E0>\nresponse = <Response [200]>, json_path = '$.msg', expected_value = 'success'\nerror_msg_prefix = '账号6421响应异常'\n\n    def assert_json_value(self, response, json_path, expected_value, error_msg_prefix):\n        \"\"\"断言JSON路径对应的值（分层提示优化）\"\"\"\n        try:\n            actual_value = self.extract_jsonpath(response, json_path)\n            if isinstance(actual_value, list) and len(actual_value) == 1:\n                actual_value = actual_value[0]\n    \n            with allure.step(f\"断言JSON路径: {json_path}\"):\n                allure.attach(response.url, \"请求URL\", allure.attachment_type.TEXT)\n                allure.attach(f\"期望值: {self.serialize_data(expected_value)}\", \"预期值\", allure.attachment_type.TEXT)\n                allure.attach(f\"实际值: {self.serialize_data(actual_value)}\", \"实际值\", allure.attachment_type.TEXT)\n    \n>           assert actual_value == expected_value, \\\n                f\"Failed: {error_msg_prefix}（JSON路径值不匹配）\"\nE               AssertionError: Failed: 账号6421响应异常（JSON路径值不匹配）\n\ncommons\\api_base.py:416: AssertionError\n\nThe above exception was the direct cause of the following exception:\n\nself = <lingkuan_1106.test_cloudTrader.test_create_scene.TestCreate_importcloudTrader object at 0x0000020B7F29F8E0>\nvar_manager = <lingkuan_1106.commons.variable_manager.VariableManager object at 0x0000020B7F1D3490>\nlogged_session = <lingkuan_1106.commons.session.EnvironmentSession object at 0x0000020B7F1FEBB0>\n\n    @allure.title(\"修改跟单账号（仅使用后6个数据与模板匹配）\")\n    def test_update_addSlave(self, var_manager, logged_session):\n        # 1. 获取总用户数（需确保至少有7个，才能取后6个）\n        cloudTrader_user_count = var_manager.get_variable(\"cloudTrader_user_count\", 0)\n        if cloudTrader_user_count < 7:\n            pytest.fail(f\"用户总数需至少为7，当前为{cloudTrader_user_count}，无法提取后6个数据\")\n    \n        all_ids = []\n        for i in range(5, cloudTrader_user_count + 1):\n            addslave_id = var_manager.get_variable(f\"cloudTrader_traderList_{i}\")\n            if not addslave_id:\n                pytest.fail(f\"未找到第{i}个账号（变量：cloudTrader_traderList_{i}）\")\n            all_ids.append(addslave_id)\n        print(f\"已提取后6个账号id：{all_ids}\")\n    \n        cloudTrader_template_id1 = var_manager.get_variable(\"cloudTrader_template_id1\")\n    \n        # 3. 定义6个模板（与账号一一对应）\n        templates: List[Dict[str, Any]] = [\n            {\n                \"followMode\": 0,\n                \"followParam\": \"5.00\",\n                \"templateId\": 1,\n                \"remark\": \"云跟单账号测试数据\",\n                \"Cfd\": \"\",\n                \"mode_desc\": \"固定手数（5倍）\"\n            },\n            {\n                \"followMode\": 1,\n                \"followParam\": \"1\",\n                \"templateId\": cloudTrader_template_id1,\n                \"remark\": \"云跟单账号测试数据\",\n                \"Cfd\": \"\",\n                \"mode_desc\": \"修改品种（3倍）\"\n            },\n            {\n                \"followMode\": 2,\n                \"followParam\": \"1\",\n                \"templateId\": 1,\n                \"remark\": \"云跟单账号测试数据\",\n                \"Cfd\": \"\",\n                \"mode_desc\": \"净值比例\"\n            },\n            {\n                \"followMode\": 1,\n                \"followParam\": \"1\",\n                \"templateId\": 1,\n                \"remark\": \"云跟单账号测试数据\",\n                \"Cfd\": \"@\",\n                \"mode_desc\": \"修改币种，合约是100\"\n            },\n            {\n                \"followMode\": 1,\n                \"followParam\": \"1\",\n                \"templateId\": 1,\n                \"remark\": \"云跟单账号测试数据\",\n                \"Cfd\": \".p\",\n                \"mode_desc\": \"修改币种，合约是100000\"\n            },\n            {\n                \"followMode\": 1,\n                \"followParam\": \"1\",\n                \"templateId\": 1,\n                \"remark\": \"云跟单账号测试数据\",\n                \"Cfd\": \".min\",\n                \"mode_desc\": \"修改币种，合约是10\"\n            },\n        ]\n    \n        # 4. 生成参数化数据（后6个账号与6个模板一一对应）\n        parametrize_data = []\n        for i in range(len(all_ids)):\n            traderList = all_ids[i]\n            template = templates[i]  # 直接一一对应（账号1→模板1，账号2→模板2，...）\n            parametrize_data.append({\n                \"followMode\": template[\"followMode\"],\n                \"followParam\": template[\"followParam\"],\n                \"templateId\": template[\"templateId\"],\n                \"remark\": template[\"remark\"],  # 修改备注\n                \"Cfd\": template[\"Cfd\"],  # 修改Cfd参数\n                \"traderList\": traderList,\n            })\n        print(f\"生成{len(parametrize_data)}条参数化测试数据（后6个账号）\")\n    \n        # 5. 循环执行后6个账号的修改操作\n        for param in parametrize_data:\n            with (allure.step(f\"1. 对数据进行参数化修改\")):\n                # 获取基础配置\n                cloudMaster_id = var_manager.get_variable(\"cloudMaster_id\")\n                cloudTrader_traderList_2 = var_manager.get_variable(\"cloudTrader_traderList_2\")\n                cloudTrader_user_accounts_2 = var_manager.get_variable(\"cloudTrader_user_accounts_2\")\n                # 构造请求数据\n                data = [\n                    {\n                        \"traderList\": [\n                            param[\"traderList\"]\n                        ],\n                        \"cloudId\": cloudMaster_id,\n                        \"masterId\": cloudTrader_traderList_2,\n                        \"masterAccount\": cloudTrader_user_accounts_2,\n                        \"followDirection\": 0,\n                        \"followMode\": param[\"followMode\"],\n                        \"followParam\": param[\"followParam\"],\n                        \"remainder\": 0,\n                        \"placedType\": 0,\n                        \"templateId\": param[\"templateId\"],\n                        \"followStatus\": 1,\n                        \"followOpen\": 1,\n                        \"followClose\": 1,\n                        \"remark\": param[\"remark\"],\n                        \"fixedComment\": \"\",\n                        \"commentType\": \"\",\n                        \"digits\": 0,\n                        \"followTraderIds\": [],\n                        \"sort\": \"100\",\n                        \"cfd\": param[\"Cfd\"],\n                        \"platformType\": 0,\n                        \"forex\": \"\"\n                    }\n                ]\n    \n                # 发送请求并验证\n                response = self.send_post_request(\n                    logged_session, '/mascontrol/cloudTrader/cloudBatchUpdate', json_data=data, sleep_seconds=3\n                )\n                print(f\"修改云跟单账号数据：{param['traderList']}\")\n    \n                self.assert_response_status(\n                    response, 200,\n                    f\"账号{param['traderList']}修改失败\"\n                )\n>               self.assert_json_value(\n                    response, \"$.msg\", \"success\",\n                    f\"账号{param['traderList']}响应异常\"\n                )\n\ntest_cloudTrader\\test_create_scene.py:253: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <lingkuan_1106.test_cloudTrader.test_create_scene.TestCreate_importcloudTrader object at 0x0000020B7F29F8E0>\nresponse = <Response [200]>, json_path = '$.msg', expected_value = 'success'\nerror_msg_prefix = '账号6421响应异常'\n\n    def assert_json_value(self, response, json_path, expected_value, error_msg_prefix):\n        \"\"\"断言JSON路径对应的值（分层提示优化）\"\"\"\n        try:\n            actual_value = self.extract_jsonpath(response, json_path)\n            if isinstance(actual_value, list) and len(actual_value) == 1:\n                actual_value = actual_value[0]\n    \n            with allure.step(f\"断言JSON路径: {json_path}\"):\n                allure.attach(response.url, \"请求URL\", allure.attachment_type.TEXT)\n                allure.attach(f\"期望值: {self.serialize_data(expected_value)}\", \"预期值\", allure.attachment_type.TEXT)\n                allure.attach(f\"实际值: {self.serialize_data(actual_value)}\", \"实际值\", allure.attachment_type.TEXT)\n    \n            assert actual_value == expected_value, \\\n                f\"Failed: {error_msg_prefix}（JSON路径值不匹配）\"\n        except Exception as e:\n            with allure.step(f\"JSON断言失败: {json_path}\"):\n                allure.attach(json_path, \"JSON路径\", allure.attachment_type.TEXT)\n                allure.attach(str(expected_value), \"预期值\", allure.attachment_type.TEXT)\n                allure.attach(response.text[:500], \"响应内容\", allure.attachment_type.TEXT)\n            logger.error(\n                f\"[{self._get_current_time()}] JSON断言失败: {str(e)} \\n路径: {json_path} \\n响应: {response.text[:500]}\")\n>           raise AssertionError(f\"Failed: {error_msg_prefix}（JSON断言失败）\") from e\nE           AssertionError: Failed: 账号6421响应异常（JSON断言失败）\n\ncommons\\api_base.py:425: AssertionError"}, "steps": [{"name": "1. 对数据进行参数化修改", "status": "passed", "steps": [{"name": "执行 POST 请求", "status": "passed", "steps": [{"name": "请求详情", "status": "passed", "attachments": [{"name": "请求URL", "source": "45d35eae-c179-480b-8b4f-7edb74a53ed7-attachment.txt", "type": "text/plain"}, {"name": "请求头", "source": "13455be1-3eb4-4b27-99f3-f3642865da6c-attachment.json", "type": "application/json"}, {"name": "请求体（JSON）", "source": "20dd738f-9402-4d53-ac75-cd4987bb2eaa-attachment.json", "type": "application/json"}], "start": 1761886329242, "stop": 1761886329243}, {"name": "响应详情", "status": "passed", "attachments": [{"name": "响应状态码", "source": "e47e78c5-3ed8-418a-9884-29414efb972b-attachment.txt", "type": "text/plain"}, {"name": "响应头", "source": "2953874b-efee-432d-99a5-bc2da28a3fb4-attachment.json", "type": "application/json"}, {"name": "响应体（JSON）", "source": "8123ec02-723c-4698-be62-8cf4e40e8570-attachment.json", "type": "application/json"}], "start": 1761886329379, "stop": 1761886329380}], "start": 1761886329242, "stop": 1761886332394}, {"name": "断言响应状态码", "status": "passed", "attachments": [{"name": "请求URL", "source": "9705fb9d-22db-49ed-8265-fed799891040-attachment.txt", "type": "text/plain"}, {"name": "预期状态码", "source": "994d7335-38fb-4842-b050-6a562b782796-attachment.txt", "type": "text/plain"}, {"name": "实际状态码", "source": "64730149-86f0-424d-8f8a-eacd28f08f3a-attachment.txt", "type": "text/plain"}, {"name": "响应内容", "source": "9ec6df15-e86b-40c3-a264-0eec48c12663-attachment.txt", "type": "text/plain"}], "start": 1761886332394, "stop": 1761886332396}, {"name": "断言JSON路径: $.msg", "status": "passed", "attachments": [{"name": "请求URL", "source": "fd7c0885-103d-4455-935f-69bde88fdbdb-attachment.txt", "type": "text/plain"}, {"name": "预期值", "source": "19ccbf68-d157-46b1-be3d-55a8b4e0d474-attachment.txt", "type": "text/plain"}, {"name": "实际值", "source": "e79ed473-83dc-49d1-9945-4678b725aec3-attachment.txt", "type": "text/plain"}], "start": 1761886332401, "stop": 1761886332402}], "start": 1761886329242, "stop": 1761886332402}, {"name": "1. 对数据进行参数化修改", "status": "passed", "steps": [{"name": "执行 POST 请求", "status": "passed", "steps": [{"name": "请求详情", "status": "passed", "attachments": [{"name": "请求URL", "source": "86261e2d-6b5c-47ae-9a4b-a91863fa974f-attachment.txt", "type": "text/plain"}, {"name": "请求头", "source": "3d044af7-5ea5-44b9-a9c4-1b8a63711bc7-attachment.json", "type": "application/json"}, {"name": "请求体（JSON）", "source": "4ebca1c9-95dc-411b-aff5-9ff532932a3e-attachment.json", "type": "application/json"}], "start": 1761886332402, "stop": 1761886332404}, {"name": "响应详情", "status": "passed", "attachments": [{"name": "响应状态码", "source": "3c0a32d7-5e0c-4204-87e0-e3211bdf0ec9-attachment.txt", "type": "text/plain"}, {"name": "响应头", "source": "90c2bc3a-4ff0-4140-9268-bdc9837b167b-attachment.json", "type": "application/json"}, {"name": "响应体（JSON）", "source": "e4f35451-bb4e-48d3-954c-74156644b573-attachment.json", "type": "application/json"}], "start": 1761886333206, "stop": 1761886333208}], "start": 1761886332402, "stop": 1761886336219}, {"name": "断言响应状态码", "status": "passed", "attachments": [{"name": "请求URL", "source": "f2d84dd9-3d63-4326-b35f-437d7e578d4c-attachment.txt", "type": "text/plain"}, {"name": "预期状态码", "source": "4a01cff5-6120-4cd3-b4ef-5eb8e3a94ca8-attachment.txt", "type": "text/plain"}, {"name": "实际状态码", "source": "030e419e-f7c0-4bca-9e44-c430f751bf45-attachment.txt", "type": "text/plain"}, {"name": "响应内容", "source": "c3620bb0-2230-4187-b497-2c9e47a2a158-attachment.txt", "type": "text/plain"}], "start": 1761886336219, "stop": 1761886336220}, {"name": "断言JSON路径: $.msg", "status": "passed", "attachments": [{"name": "请求URL", "source": "8a53e7dd-7e72-49b1-8d64-fede54a04bd1-attachment.txt", "type": "text/plain"}, {"name": "预期值", "source": "8055fe9b-0775-4c3b-bb1c-a4ecc1c73a31-attachment.txt", "type": "text/plain"}, {"name": "实际值", "source": "c8e8e5e8-44aa-4ade-b7f3-d5ba8e03c3dd-attachment.txt", "type": "text/plain"}], "start": 1761886336224, "stop": 1761886336226}], "start": 1761886332402, "stop": 1761886336226}, {"name": "1. 对数据进行参数化修改", "status": "passed", "steps": [{"name": "执行 POST 请求", "status": "passed", "steps": [{"name": "请求详情", "status": "passed", "attachments": [{"name": "请求URL", "source": "280e9b53-d686-49b4-92d4-331f9e37b04c-attachment.txt", "type": "text/plain"}, {"name": "请求头", "source": "ea2302b6-22cf-4620-acdd-5f6f2dc5c085-attachment.json", "type": "application/json"}, {"name": "请求体（JSON）", "source": "86522e20-f2d7-4f1c-8e49-425ca5e42efc-attachment.json", "type": "application/json"}], "start": 1761886336226, "stop": 1761886336227}, {"name": "响应详情", "status": "passed", "attachments": [{"name": "响应状态码", "source": "c3a51056-750f-4f3a-87e7-8f9f2b75a2aa-attachment.txt", "type": "text/plain"}, {"name": "响应头", "source": "ed8d814f-1192-41f1-a7bb-796aa1f66825-attachment.json", "type": "application/json"}, {"name": "响应体（JSON）", "source": "7e45693c-9958-4c21-b37d-4c48ece09909-attachment.json", "type": "application/json"}], "start": 1761886336337, "stop": 1761886336339}], "start": 1761886336226, "stop": 1761886339339}, {"name": "断言响应状态码", "status": "passed", "attachments": [{"name": "请求URL", "source": "72252d40-e6ae-4f0a-ad2e-cddba048a881-attachment.txt", "type": "text/plain"}, {"name": "预期状态码", "source": "8fd63f2e-fc87-4cf1-9ab5-d372806b8c94-attachment.txt", "type": "text/plain"}, {"name": "实际状态码", "source": "8732bca3-6178-4288-b24e-8cc34fd6cb7f-attachment.txt", "type": "text/plain"}, {"name": "响应内容", "source": "5909104b-e85f-4f8f-b66e-a027b5cdb6a6-attachment.txt", "type": "text/plain"}], "start": 1761886339339, "stop": 1761886339341}, {"name": "断言JSON路径: $.msg", "status": "passed", "attachments": [{"name": "请求URL", "source": "3afd27ab-b709-4ffc-a6a4-c60a9e640f12-attachment.txt", "type": "text/plain"}, {"name": "预期值", "source": "40576924-1e9f-4234-b8c6-61c5d8179202-attachment.txt", "type": "text/plain"}, {"name": "实际值", "source": "be6ed9d4-a037-44cd-ab61-18f4b331209d-attachment.txt", "type": "text/plain"}], "start": 1761886339345, "stop": 1761886339346}], "start": 1761886336226, "stop": 1761886339346}, {"name": "1. 对数据进行参数化修改", "status": "failed", "statusDetails": {"message": "AssertionError: Failed: 账号6421响应异常（JSON断言失败）\n", "trace": "  File \"D:\\pycharm_test\\lingkuan_1106\\test_cloudTrader\\test_create_scene.py\", line 253, in test_update_addSlave\n    self.assert_json_value(\n  File \"D:\\pycharm_test\\lingkuan_1106\\commons\\api_base.py\", line 425, in assert_json_value\n    raise AssertionError(f\"Failed: {error_msg_prefix}（JSON断言失败）\") from e\n"}, "steps": [{"name": "执行 POST 请求", "status": "passed", "steps": [{"name": "请求详情", "status": "passed", "attachments": [{"name": "请求URL", "source": "e0146aca-db8e-425e-978d-d27bc27dc044-attachment.txt", "type": "text/plain"}, {"name": "请求头", "source": "e39f303c-eace-460c-b533-226c5f6f131d-attachment.json", "type": "application/json"}, {"name": "请求体（JSON）", "source": "c93089be-dfa2-48fa-a6ef-d8ebc5dfbba1-attachment.json", "type": "application/json"}], "start": 1761886339346, "stop": 1761886339346}, {"name": "响应详情", "status": "passed", "attachments": [{"name": "响应状态码", "source": "d976d33d-d215-4643-bd4d-22b5fa854f69-attachment.txt", "type": "text/plain"}, {"name": "响应头", "source": "b8ac5a5b-16e2-47ad-8d37-ba473dea0113-attachment.json", "type": "application/json"}, {"name": "响应体（JSON）", "source": "b1db2bb6-6453-43c0-9e1a-cfede48d1774-attachment.json", "type": "application/json"}], "start": 1761886339413, "stop": 1761886339415}], "start": 1761886339346, "stop": 1761886342429}, {"name": "断言响应状态码", "status": "passed", "attachments": [{"name": "请求URL", "source": "c0ba056f-c7b2-472f-8299-84b64a672216-attachment.txt", "type": "text/plain"}, {"name": "预期状态码", "source": "2fcdf705-1734-4abc-98d7-86b6deda8cc5-attachment.txt", "type": "text/plain"}, {"name": "实际状态码", "source": "86e5d438-95c3-4b22-ab65-829588d33139-attachment.txt", "type": "text/plain"}, {"name": "响应内容", "source": "0a85c593-5ce1-4927-b712-82d29d712d7f-attachment.txt", "type": "text/plain"}], "start": 1761886342429, "stop": 1761886342431}, {"name": "断言JSON路径: $.msg", "status": "passed", "attachments": [{"name": "请求URL", "source": "7d387afd-9906-4a08-9e8d-af29b4098f1f-attachment.txt", "type": "text/plain"}, {"name": "预期值", "source": "a6121bd0-7016-4414-b4ce-b88e0639610b-attachment.txt", "type": "text/plain"}, {"name": "实际值", "source": "1e1e971c-bd1d-475a-9bed-869cdd40be3e-attachment.txt", "type": "text/plain"}], "start": 1761886342439, "stop": 1761886342440}, {"name": "JSON断言失败: $.msg", "status": "passed", "attachments": [{"name": "JSON路径", "source": "ed484e96-340c-4f89-9b89-85ff5910d055-attachment.txt", "type": "text/plain"}, {"name": "预期值", "source": "4ec674ad-ea44-49d9-a677-53988179e836-attachment.txt", "type": "text/plain"}, {"name": "响应内容", "source": "3165c19f-761c-44e7-a590-aa1c17ec3f96-attachment.txt", "type": "text/plain"}], "start": 1761886342440, "stop": 1761886342442}], "start": 1761886339346, "stop": 1761886342443}], "attachments": [{"name": "log", "source": "4304d4d6-2678-4612-8564-48d0893e10c2-attachment.txt", "type": "text/plain"}], "start": 1761886329241, "stop": 1761886342443, "uuid": "d309dd38-2108-4306-bb26-8232628d17c9", "historyId": "c8be5d3653baacab767e7f484097b488", "testCaseId": "c8be5d3653baacab767e7f484097b488", "fullName": "test_cloudTrader.test_create_scene.TestCreate_importcloudTrader#test_update_addSlave", "labels": [{"name": "feature", "value": "云策略-云策略列表-批量新增云跟单账号"}, {"name": "parentSuite", "value": "test_cloudTrader"}, {"name": "suite", "value": "test_create_scene"}, {"name": "subSuite", "value": "TestCreate_importcloudTrader"}, {"name": "host", "value": "DESKTOP-4S9CU1E"}, {"name": "thread", "value": "40584-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_cloudTrader.test_create_scene"}]}