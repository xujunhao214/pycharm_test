{"name": "数据库校验-VPS数据-验证账号是否下架成功（后9个账号）", "status": "failed", "statusDetails": {"message": "AssertionError: 第2个账号（31581）的订阅表记录未删除，残留数据：[{'id': 8949, 'master_id': 15298, 'slave_id': 15306, 'master_account': '31580', 'slave_account': '31581', 'follow_mode': 1, 'follow_param': 1.0, 'follow_status': 1, 'follow_open': 1, 'follow_close': 1, 'follow_rep': 1, 'placed_type': 0, 'tp_sl': 0, 'follow_direction': 0, 'pause': 0, 'remark': None, 'order_num': 0, 'version': 0, 'deleted': 0, 'creator': None, 'create_time': '2025-11-12 16:11:47', 'updater': None, 'update_time': '2025-11-12 16:11:47', 'remainder': 0, 'fixed_comment': None, 'comment_type': None, 'digits': 0}]\nassert not [{'comment_type': None, 'create_time': '2025-11-12 16:11:47', 'creator': None, 'deleted': 0, ...}]", "trace": "self = <lingkuan_150.test_cloudTrader.test_delete.TestDelete_cloudTrader object at 0x000001FF3220AD60>\nvar_manager = <lingkuan_150.commons.variable_manager.VariableManager object at 0x000001FF32240250>\ndb_transaction = <DBUtils.PooledDB.PooledDedicatedDBConnection object at 0x000001FF322F8A60>\n\n    @allure.title(\"数据库校验-VPS数据-验证账号是否下架成功（后9个账号）\")\n    def test_dbdelete_belowVps(self, var_manager, db_transaction):\n        # 1. 获取账号总数和所有账号信息\n        cloudTrader_user_count = var_manager.get_variable(\"cloudTrader_user_count\", 0)\n        if cloudTrader_user_count < 10:  # 修改条件为至少10个账号\n            pytest.fail(f\"用户总数需至少为10，当前为{cloudTrader_user_count}，无法提取后9个数据进行校验\")\n    \n        # 2. 循环验证后9个账号的下架状态\n        for i in range(2, cloudTrader_user_count + 1):  # 循环索引2-10（共9次）\n            with allure.step(f\"验证第{i}个账号是否下架成功\"):\n                # 获取单个账号（与下架的ID对应）\n                account = var_manager.get_variable(f\"cloudTrader_user_accounts_{i}\")\n                if not account:\n                    pytest.fail(f\"未找到需要验证的账号：cloudTrader_user_accounts_{i}\")\n    \n                # 查询数据库（检查删除标记或记录是否存在）\n                sql = f\"SELECT * FROM follow_trader WHERE account = %s\"\n    \n                # 调用轮询等待方法，验证记录是否被删除\n                try:\n                    self.wait_for_database_deletion(\n                        db_transaction=db_transaction,\n                        sql=sql,\n                        params=(account,)\n                    )\n                    allure.attach(f\"账号 {account} 已成功下架vps\", \"验证结果\", allure.attachment_type.TEXT)\n                    # print(f\"\\n账号 {account} 已成功下架vps\")\n                except TimeoutError as e:\n                    allure.attach(f\"下架超时: {str(e)}\", \"验证结果\", allure.attachment_type.TEXT)\n                    pytest.fail(f\"下架失败: {str(e)}\")\n    \n                # 验证订阅表是否同步删除\n                sql_sub = f\"SELECT * FROM follow_trader_subscribe WHERE slave_account = %s\"\n                db_data_sub = self.query_database(db_transaction, sql_sub, (account,))\n>               assert not db_data_sub, (\n                    f\"第{i}个账号（{account}）的订阅表记录未删除，\"\n                    f\"残留数据：{db_data_sub}\"\n                )\nE               AssertionError: 第2个账号（31581）的订阅表记录未删除，残留数据：[{'id': 8949, 'master_id': 15298, 'slave_id': 15306, 'master_account': '31580', 'slave_account': '31581', 'follow_mode': 1, 'follow_param': 1.0, 'follow_status': 1, 'follow_open': 1, 'follow_close': 1, 'follow_rep': 1, 'placed_type': 0, 'tp_sl': 0, 'follow_direction': 0, 'pause': 0, 'remark': None, 'order_num': 0, 'version': 0, 'deleted': 0, 'creator': None, 'create_time': '2025-11-12 16:11:47', 'updater': None, 'update_time': '2025-11-12 16:11:47', 'remainder': 0, 'fixed_comment': None, 'comment_type': None, 'digits': 0}]\nE               assert not [{'comment_type': None, 'create_time': '2025-11-12 16:11:47', 'creator': None, 'deleted': 0, ...}]\n\ntest_cloudTrader\\test_delete.py:362: AssertionError"}, "steps": [{"name": "验证第2个账号是否下架成功", "status": "failed", "statusDetails": {"message": "AssertionError: 第2个账号（31581）的订阅表记录未删除，残留数据：[{'id': 8949, 'master_id': 15298, 'slave_id': 15306, 'master_account': '31580', 'slave_account': '31581', 'follow_mode': 1, 'follow_param': 1.0, 'follow_status': 1, 'follow_open': 1, 'follow_close': 1, 'follow_rep': 1, 'placed_type': 0, 'tp_sl': 0, 'follow_direction': 0, 'pause': 0, 'remark': None, 'order_num': 0, 'version': 0, 'deleted': 0, 'creator': None, 'create_time': '2025-11-12 16:11:47', 'updater': None, 'update_time': '2025-11-12 16:11:47', 'remainder': 0, 'fixed_comment': None, 'comment_type': None, 'digits': 0}]\nassert not [{'comment_type': None, 'create_time': '2025-11-12 16:11:47', 'creator': None, 'deleted': 0, ...}]\n", "trace": "  File \"D:\\pycharm_test\\lingkuan_150\\test_cloudTrader\\test_delete.py\", line 362, in test_dbdelete_belowVps\n    assert not db_data_sub, (\n"}, "steps": [{"name": "等待数据库记录删除（超时: 5秒）", "status": "passed", "steps": [{"name": "执行数据库查询", "status": "passed", "start": 1762936433785, "stop": 1762936433836}, {"name": "等待中（已等待0.1秒）", "status": "passed", "attachments": [{"name": "当前状态", "source": "7a41bdb9-6479-452f-878f-b1d828eed80f-attachment.txt", "type": "text/plain"}, {"name": "超时倒计时", "source": "e3fd5185-4566-46b7-887b-ba3572876e57-attachment.txt", "type": "text/plain"}], "start": 1762936433836, "stop": 1762936433837}, {"name": "删除验证成功", "status": "passed", "attachments": [{"name": "结果说明", "source": "98765e5d-7498-4c04-997f-00aabd6a9321-attachment.txt", "type": "text/plain"}, {"name": "执行SQL", "source": "1255f3b0-7f4d-446a-b3b6-cfd7915f6b8f-attachment.txt", "type": "text/plain"}, {"name": "SQL参数", "source": "99b1deab-a27a-41e1-9d9b-19390cde1cbc-attachment.txt", "type": "text/plain"}], "start": 1762936433837, "stop": 1762936433838}], "start": 1762936433733, "stop": 1762936433838}, {"name": "执行数据库查询", "status": "passed", "steps": [{"name": "数据库查询结果", "status": "passed", "attachments": [{"name": "查询结果（共1条，显示前50条）", "source": "2721b09e-ceaf-4fb1-a4f1-c6fcae7253e5-attachment.json", "type": "application/json"}, {"name": "执行SQL", "source": "1ba73b16-15fa-45f7-baf8-61acb3b33abd-attachment.txt", "type": "text/plain"}, {"name": "SQL参数", "source": "1135662d-087f-43d2-a114-0ab16125f68b-attachment.txt", "type": "text/plain"}], "start": 1762936433888, "stop": 1762936433889}], "start": 1762936433839, "stop": 1762936433889}], "attachments": [{"name": "验证结果", "source": "f13a49ea-cdd6-48b9-9970-2065f8dc4446-attachment.txt", "type": "text/plain"}], "start": 1762936433732, "stop": 1762936433889}], "attachments": [{"name": "log", "source": "b38a01e4-cd5f-4a2c-b4b5-364a2ebd13e1-attachment.txt", "type": "text/plain"}], "start": 1762936433732, "stop": 1762936433890, "uuid": "f5084941-ae42-4a8c-8485-c2d76e6ebf53", "historyId": "ec8a5572e8eb986949bd183cf7a5f323", "testCaseId": "ec8a5572e8eb986949bd183cf7a5f323", "fullName": "test_cloudTrader.test_delete.TestDelete_cloudTrader#test_dbdelete_belowVps", "labels": [{"name": "feature", "value": "数据管理-删除云策略测试数据"}, {"name": "parentSuite", "value": "test_cloudTrader"}, {"name": "suite", "value": "test_delete"}, {"name": "subSuite", "value": "TestDelete_cloudTrader"}, {"name": "host", "value": "DESKTOP-4S9CU1E"}, {"name": "thread", "value": "28568-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_cloudTrader.test_delete"}]}