{"name": "数据库校验-VPS数据-批量删除跟单账号", "status": "failed", "statusDetails": {"message": "AssertionError: 第1个账号（31492）的订阅表记录未删除，残留数据：[{'id': 7388, 'master_id': 13104, 'slave_id': 13105, 'master_account': '31491', 'slave_account': '31492', 'follow_mode': 1, 'follow_param': 1.0, 'follow_status': 1, 'follow_open': 1, 'follow_close': 1, 'follow_rep': 0, 'placed_type': 0, 'tp_sl': 0, 'follow_direction': 0, 'pause': 0, 'remark': '', 'order_num': 0, 'version': 0, 'deleted': 0, 'creator': None, 'create_time': '2025-10-24 17:00:06', 'updater': None, 'update_time': '2025-10-24 17:00:06', 'remainder': 0, 'fixed_comment': '', 'comment_type': None, 'digits': 0}]\nassert not [{'comment_type': None, 'create_time': '2025-10-24 17:00:06', 'creator': None, 'deleted': 0, ...}]", "trace": "self = <lingkuan_MT4DE.test_vps.test_delete.TestDeleteUser object at 0x000002258F5CFFA0>\nvar_manager = <lingkuan_MT4DE.commons.variable_manager.VariableManager object at 0x000002258F7B7280>\ndb_transaction = <pymysql.connections.Connection object at 0x000002258F732130>\n\n    @allure.title(\"数据库校验-VPS数据-批量删除跟单账号\")\n    def test_dbdelete_addsalvelist(self, var_manager, db_transaction):\n        # 1. 获取账号总数和所有账号信息\n        vps_addslave_count = var_manager.get_variable(\"vps_addslave_count\", 0)\n        if vps_addslave_count <= 0:\n            pytest.fail(\"未找到需要验证的账号数量，请检查前置步骤\")\n    \n        # 2. 循环验证每个账号的删除状态\n        for i in range(1, vps_addslave_count + 1):\n            with allure.step(f\"验证第{i}个账号是否删除成功\"):\n                # 获取单个账号（与删除的ID对应）\n                account = var_manager.get_variable(f\"vps_user_accounts_{i}\")\n                if not account:\n                    pytest.fail(f\"未找到需要验证的账号：vps_user_accounts_{i}\")\n    \n                # 查询数据库（检查删除标记或记录是否存在）\n                sql = f\"SELECT * FROM follow_trader WHERE account = %s\"\n                # 调用轮询等待方法（带时间范围过滤）\n                try:\n                    self.wait_for_database_deletion(\n                        db_transaction=db_transaction,\n                        sql=sql,\n                        params=(account,)\n                    )\n                    allure.attach(f\"跟单账号 {account} 已成功从数据库删除\", \"验证结果\")\n                except TimeoutError as e:\n                    allure.attach(f\"删除超时: {str(e)}\", \"验证结果\")\n                    pytest.fail(f\"删除失败: {str(e)}\")\n    \n                # 验证订阅表是否同步删除\n                sql_sub = f\"SELECT * FROM follow_trader_subscribe WHERE slave_account = %s\"\n                db_data_sub = self.query_database(db_transaction, sql_sub, (account,))\n>               assert not db_data_sub, (\n                    f\"第{i}个账号（{account}）的订阅表记录未删除，\"\n                    f\"残留数据：{db_data_sub}\"\n                )\nE               AssertionError: 第1个账号（31492）的订阅表记录未删除，残留数据：[{'id': 7388, 'master_id': 13104, 'slave_id': 13105, 'master_account': '31491', 'slave_account': '31492', 'follow_mode': 1, 'follow_param': 1.0, 'follow_status': 1, 'follow_open': 1, 'follow_close': 1, 'follow_rep': 0, 'placed_type': 0, 'tp_sl': 0, 'follow_direction': 0, 'pause': 0, 'remark': '', 'order_num': 0, 'version': 0, 'deleted': 0, 'creator': None, 'create_time': '2025-10-24 17:00:06', 'updater': None, 'update_time': '2025-10-24 17:00:06', 'remainder': 0, 'fixed_comment': '', 'comment_type': None, 'digits': 0}]\nE               assert not [{'comment_type': None, 'create_time': '2025-10-24 17:00:06', 'creator': None, 'deleted': 0, ...}]\n\ntest_vps\\test_delete.py:313: AssertionError"}, "steps": [{"name": "验证第1个账号是否删除成功", "status": "failed", "statusDetails": {"message": "AssertionError: 第1个账号（31492）的订阅表记录未删除，残留数据：[{'id': 7388, 'master_id': 13104, 'slave_id': 13105, 'master_account': '31491', 'slave_account': '31492', 'follow_mode': 1, 'follow_param': 1.0, 'follow_status': 1, 'follow_open': 1, 'follow_close': 1, 'follow_rep': 0, 'placed_type': 0, 'tp_sl': 0, 'follow_direction': 0, 'pause': 0, 'remark': '', 'order_num': 0, 'version': 0, 'deleted': 0, 'creator': None, 'create_time': '2025-10-24 17:00:06', 'updater': None, 'update_time': '2025-10-24 17:00:06', 'remainder': 0, 'fixed_comment': '', 'comment_type': None, 'digits': 0}]\nassert not [{'comment_type': None, 'create_time': '2025-10-24 17:00:06', 'creator': None, 'deleted': 0, ...}]\n", "trace": "  File \"D:\\pycharm_test\\lingkuan_MT4DE\\test_vps\\test_delete.py\", line 313, in test_dbdelete_addsalvelist\n    assert not db_data_sub, (\n"}, "steps": [{"name": "等待数据库记录删除（超时: 5秒）", "status": "passed", "steps": [{"name": "执行数据库查询", "status": "passed", "attachments": [{"name": "执行SQL", "source": "9d140df4-923a-42c3-b588-61b9fa0a63e3-attachment.txt", "type": "text/plain"}, {"name": "SQL参数", "source": "b2d2f406-f9e9-4aeb-92d8-9367aab8ac07-attachment.txt", "type": "text/plain"}], "start": 1761296806113, "stop": 1761296806162}, {"name": "等待中（已等待0.1秒）", "status": "passed", "attachments": [{"name": "当前状态", "source": "1337d9d5-0ea7-4a8d-9abd-b83a2177b139-attachment.txt", "type": "text/plain"}, {"name": "超时倒计时", "source": "5fbb63a5-4401-427d-9050-dac964ebf76c-attachment.txt", "type": "text/plain"}], "start": 1761296806162, "stop": 1761296806163}, {"name": "删除验证成功", "status": "passed", "attachments": [{"name": "结果说明", "source": "50ed24cb-0015-4c14-85c3-9a3b09ec677d-attachment.txt", "type": "text/plain"}], "start": 1761296806163, "stop": 1761296806163}], "attachments": [{"name": "执行SQL", "source": "c99d9c47-5129-487f-80b4-2d0426301cea-attachment.txt", "type": "text/plain"}, {"name": "SQL参数", "source": "28fd9ed2-47ab-4375-a9f8-fdd82e66755f-attachment.txt", "type": "text/plain"}, {"name": "查询时间窗口", "source": "c3bf5ea7-f3a1-42fe-be3e-93910ec90050-attachment.txt", "type": "text/plain"}], "start": 1761296806066, "stop": 1761296806163}, {"name": "执行数据库查询", "status": "passed", "steps": [{"name": "数据库查询结果", "status": "passed", "attachments": [{"name": "查询结果（共1条，显示前50条）", "source": "74ece983-a6cd-4194-91ef-0ca83ee13aab-attachment.json", "type": "application/json"}], "start": 1761296806209, "stop": 1761296806210}], "attachments": [{"name": "执行SQL", "source": "12a5532f-a139-4925-8354-6c59ce4535ec-attachment.txt", "type": "text/plain"}, {"name": "SQL参数", "source": "45370f2b-e4f4-4787-8ed3-cd5c1ef8018e-attachment.txt", "type": "text/plain"}], "start": 1761296806163, "stop": 1761296806210}], "attachments": [{"name": "验证结果", "source": "15832461-33ff-46de-b6bd-f8f815ff8f75-attachment.attach"}], "start": 1761296806066, "stop": 1761296806210}], "attachments": [{"name": "log", "source": "2e1d6102-3848-4ce1-afd2-69e87f3c1b57-attachment.txt", "type": "text/plain"}], "start": 1761296806066, "stop": 1761296806211, "uuid": "dde7991c-1900-468d-8a45-57fde878b6b2", "historyId": "e550712698990bee4d24b19f48ded267", "testCaseId": "e550712698990bee4d24b19f48ded267", "fullName": "test_vps.test_delete.TestDeleteUser#test_dbdelete_addsalvelist", "labels": [{"name": "feature", "value": "数据管理-删除VPS测试数据"}, {"name": "parentSuite", "value": "test_vps"}, {"name": "suite", "value": "test_delete"}, {"name": "subSuite", "value": "TestDeleteUser"}, {"name": "host", "value": "DESKTOP-4S9CU1E"}, {"name": "thread", "value": "45372-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_vps.test_delete"}]}