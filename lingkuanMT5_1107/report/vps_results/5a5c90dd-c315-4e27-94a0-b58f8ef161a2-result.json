{"name": "数据库校验-交易平仓-跟单指令及订单详情数据检查", "status": "failed", "statusDetails": {"message": "AssertionError: Failed: 订单详情列表的手数：[0.79]和指令列表的手数：[0.0]不一致（忽略顺序）", "trace": "self = <lingkuanMT5_1107.test_vps.test_vps_masOrderSend.TestVPSMasOrdersend.TestVPStradingOrders6 object at 0x000001D612EEF6A0>\nclass_random_str = 'h9lh8132'\nvar_manager = <lingkuanMT5_1107.commons.variable_manager.VariableManager object at 0x000001D612FCFAC0>\ndb_transaction = <DBUtils.PooledDB.PooledDedicatedDBConnection object at 0x000001D6130AFAC0>\n\n    @allure.title(\"数据库校验-交易平仓-跟单指令及订单详情数据检查\")\n    def test_dbquery_addsalve_orderSendclose(self, class_random_str, var_manager, db_transaction):\n        with allure.step(\"1. 获取订单详情表账号数据\"):\n            MT5vps_user_accounts_1 = var_manager.get_variable(\"MT5vps_user_accounts_1\")\n            MT5vps_addslave_id = var_manager.get_variable(\"MT5vps_addslave_id\")\n            sql = f\"\"\"\n                    SELECT\n                        fod.size,\n                        fod.close_no,\n                        fod.magical,\n                        fod.open_price,\n                        fod.comment,\n                        fod.symbol,\n                        fod.order_no,\n                        foi.true_total_lots,\n                        foi.order_no,\n                        foi.operation_type,\n                        foi.create_time,\n                        foi.status,\n                        foi.min_lot_size,\n                        foi.max_lot_size,\n                        foi.total_lots,\n                        foi.master_order,\n                        foi.total_orders\n                    FROM\n                        follow_order_detail fod\n                    INNER JOIN\n                        follow_order_instruct foi\n                    ON\n                        foi.order_no = fod.close_no COLLATE utf8mb4_0900_ai_ci\n                    WHERE foi.operation_type = %s\n                        AND fod.account = %s\n                        AND fod.trader_id = %s\n                        AND fod.comment = %s\n                        \"\"\"\n            params = (\n                '1',\n                MT5vps_user_accounts_1,\n                MT5vps_addslave_id,\n                class_random_str\n            )\n    \n            # 调用轮询等待方法（带时间范围过滤）\n            db_data = self.query_database_with_time_with_timezone(\n                db_transaction=db_transaction,\n                sql=sql,\n                params=params,\n                time_field=\"fod.close_time\"\n            )\n        with allure.step(\"2. 数据校验\"):\n            size = [record[\"size\"] for record in db_data]\n            total_lots = [record[\"total_lots\"] for record in db_data]\n>           self.assert_list_equal_ignore_order(\n                size,\n                total_lots,\n                f\"订单详情列表的手数：{size}和指令列表的手数：{total_lots}不一致\"\n            )\n\ntest_vps\\test_vps_masOrderSend.py:2431: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\ncommons\\api_base.py:1240: in assert_list_equal_ignore_order\n    raise e\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <lingkuanMT5_1107.test_vps.test_vps_masOrderSend.TestVPSMasOrdersend.TestVPStradingOrders6 object at 0x000001D612EEF6A0>\nlist1 = [0.79], list2 = [0.0]\nerror_msg_prefix = '订单详情列表的手数：[0.79]和指令列表的手数：[0.0]不一致'\n\n    def assert_list_equal_ignore_order(self, list1, list2, error_msg_prefix=\"列表元素不匹配\"):\n        \"\"\"断言两个列表元素相同（忽略顺序，带Allure分层提示）\"\"\"\n        from collections import Counter\n        with allure.step(\"断言列表元素相同（忽略顺序）\"):\n            allure.attach(self.serialize_data(list1), \"实际列表\", attachment_type=\"text/plain\")\n            allure.attach(self.serialize_data(list2), \"预期列表\", attachment_type=\"text/plain\")\n    \n        try:\n>           assert Counter(list1) == Counter(list2), f\"Failed: {error_msg_prefix}（忽略顺序）\"\nE           AssertionError: Failed: 订单详情列表的手数：[0.79]和指令列表的手数：[0.0]不一致（忽略顺序）\n\ncommons\\api_base.py:1235: AssertionError"}, "description": "\n    ### 测试说明\n    - 前置条件：有vps策略和vps跟单\n      1. 进行开仓，手数范围0.1-1，总订单5-停止功能\n      2. 点击停止\n      3. 校验账号的下单总手数和数据库的手数，应该不相等\n      4. 进行平仓\n      5. 校验账号的数据是否正确\n    - 预期结果：账号的数据正确\n    ", "steps": [{"name": "1. 获取订单详情表账号数据", "status": "passed", "steps": [{"name": "轮询等待数据稳定（时区+06:00，超时30秒）", "status": "passed", "steps": [{"name": "带时区转换查询（目标时区: +06:00）", "status": "passed", "steps": [{"name": "执行数据库查询", "status": "passed", "start": 1762488158297, "stop": 1762488158349}], "attachments": [{"name": "时区处理", "source": "b93acaee-3806-4b54-9cf0-b8827e9e5f7b-attachment.txt", "type": "text/plain"}, {"name": "查询条件", "source": "5ab1b3f5-790d-42e5-a8f5-aa0e3ea18556-attachment.txt", "type": "text/plain"}], "start": 1762488158296, "stop": 1762488158349}, {"name": "轮询中（已等待0.1秒）", "status": "passed", "attachments": [{"name": "当前状态", "source": "e1eeb318-946d-4864-9ef9-861993fe8ad7-attachment.txt", "type": "text/plain"}, {"name": "超时倒计时", "source": "920190c0-340f-4e25-b227-25d372975511-attachment.txt", "type": "text/plain"}], "start": 1762488158349, "stop": 1762488158351}, {"name": "判断结果稳定性", "status": "passed", "attachments": [{"name": "判断结果", "source": "381c0dd5-91f1-4eea-9401-d9c160c36550-attachment.txt", "type": "text/plain"}], "start": 1762488158351, "stop": 1762488158351}, {"name": "数据发生变化", "status": "passed", "attachments": [{"name": "状态说明", "source": "d4fca1d3-c827-4125-ba14-9c4bf5c4c8e3-attachment.txt", "type": "text/plain"}], "start": 1762488158351, "stop": 1762488158352}, {"name": "带时区转换查询（目标时区: +06:00）", "status": "passed", "steps": [{"name": "执行数据库查询", "status": "passed", "start": 1762488160408, "stop": 1762488160459}], "attachments": [{"name": "时区处理", "source": "ca2946ff-4346-4297-a426-25ddeeacb51d-attachment.txt", "type": "text/plain"}, {"name": "查询条件", "source": "4565cfe2-d2c6-4d8a-a091-7cc2b7f644a3-attachment.txt", "type": "text/plain"}], "start": 1762488160406, "stop": 1762488160459}, {"name": "轮询中（已等待2.2秒）", "status": "passed", "attachments": [{"name": "当前状态", "source": "a3ef1be4-43b4-460a-8085-21cd690d128c-attachment.txt", "type": "text/plain"}, {"name": "超时倒计时", "source": "890ad977-3b57-46c8-9ac4-a6ccf027ca60-attachment.txt", "type": "text/plain"}], "start": 1762488160459, "stop": 1762488160461}, {"name": "判断结果稳定性", "status": "passed", "attachments": [{"name": "唯一键信息", "source": "70788e11-720f-4b9d-a161-e7975099b8b9-attachment.txt", "type": "text/plain"}, {"name": "判断结果", "source": "f277fda0-ee2f-4e34-b3c8-7212074b0572-attachment.txt", "type": "text/plain"}], "start": 1762488160461, "stop": 1762488160461}, {"name": "数据首次稳定", "status": "passed", "attachments": [{"name": "状态说明", "source": "fed76b84-f0d0-4844-9a50-55c259106c67-attachment.txt", "type": "text/plain"}], "start": 1762488160461, "stop": 1762488160462}, {"name": "带时区转换查询（目标时区: +06:00）", "status": "passed", "steps": [{"name": "执行数据库查询", "status": "passed", "start": 1762488162524, "stop": 1762488162579}], "attachments": [{"name": "时区处理", "source": "b4b3b1cf-b51a-4e39-98a1-525ed0bbf28c-attachment.txt", "type": "text/plain"}, {"name": "查询条件", "source": "bf619314-5d96-4760-94fa-5b6d3cc24253-attachment.txt", "type": "text/plain"}], "start": 1762488162523, "stop": 1762488162579}, {"name": "轮询中（已等待4.3秒）", "status": "passed", "attachments": [{"name": "当前状态", "source": "4bffbac4-8e4f-4266-9b5a-1439005d16be-attachment.txt", "type": "text/plain"}, {"name": "超时倒计时", "source": "31386f96-edec-44f5-8704-ba6d85b725ff-attachment.txt", "type": "text/plain"}], "start": 1762488162579, "stop": 1762488162580}, {"name": "判断结果稳定性", "status": "passed", "attachments": [{"name": "唯一键信息", "source": "1b2f7981-68c2-4c0f-9cdb-515d09d2e689-attachment.txt", "type": "text/plain"}, {"name": "判断结果", "source": "e2834e13-36d9-4d27-bdfe-afd63b779976-attachment.txt", "type": "text/plain"}], "start": 1762488162580, "stop": 1762488162581}, {"name": "数据稳定达标", "status": "passed", "attachments": [{"name": "结果说明", "source": "71700dd2-2b69-4fd5-8835-eb44a4a56f54-attachment.txt", "type": "text/plain"}], "start": 1762488162582, "stop": 1762488162582}, {"name": "带时区查询最终结果", "status": "passed", "attachments": [{"name": "结果预览", "source": "d241e606-9ddc-4dbf-a3ac-0e19f1dffa97-attachment.json", "type": "application/json"}, {"name": "执行SQL", "source": "47d4e69e-131a-4980-afe0-f590fb6499ab-attachment.txt", "type": "text/plain"}, {"name": "SQL参数", "source": "1dbfa4aa-fec5-40f1-bd3e-9126a358ebf8-attachment.txt", "type": "text/plain"}, {"name": "时区偏移量（小时）", "source": "b39cb8f6-56f6-4070-8cad-010338d4855b-attachment.txt", "type": "text/plain"}, {"name": "查询时间窗口", "source": "4c4bb656-a294-49b4-931e-59e321533b08-attachment.txt", "type": "text/plain"}], "start": 1762488162582, "stop": 1762488162585}], "start": 1762488158233, "stop": 1762488162585}], "start": 1762488158233, "stop": 1762488162585}, {"name": "2. 数据校验", "status": "failed", "statusDetails": {"message": "AssertionError: Failed: 订单详情列表的手数：[0.79]和指令列表的手数：[0.0]不一致（忽略顺序）\n", "trace": "  File \"D:\\pycharm_test\\lingkuanMT5_1107\\test_vps\\test_vps_masOrderSend.py\", line 2431, in test_dbquery_addsalve_orderSendclose\n    self.assert_list_equal_ignore_order(\n  File \"D:\\pycharm_test\\lingkuanMT5_1107\\commons\\api_base.py\", line 1240, in assert_list_equal_ignore_order\n    raise e\n  File \"D:\\pycharm_test\\lingkuanMT5_1107\\commons\\api_base.py\", line 1235, in assert_list_equal_ignore_order\n    assert Counter(list1) == Counter(list2), f\"Failed: {error_msg_prefix}（忽略顺序）\"\n"}, "steps": [{"name": "断言列表元素相同（忽略顺序）", "status": "passed", "attachments": [{"name": "实际列表", "source": "605d7846-89bb-41cc-a7ae-a710220cd8ec-attachment.attach", "type": "text/plain"}, {"name": "预期列表", "source": "8fbd69ae-12df-4030-aa2f-89b34758b445-attachment.attach", "type": "text/plain"}], "start": 1762488162585, "stop": 1762488162586}, {"name": "列表元素断言失败", "status": "passed", "attachments": [{"name": "断言结果", "source": "016f6e83-2aa7-43b0-b808-f23a8d5a5707-attachment.attach", "type": "text/plain"}], "start": 1762488162586, "stop": 1762488162587}], "start": 1762488162585, "stop": 1762488162587}], "attachments": [{"name": "log", "source": "35f7ba2c-04db-4274-9aea-5b9461f70cce-attachment.txt", "type": "text/plain"}], "start": 1762488158233, "stop": 1762488162590, "uuid": "e95c5aa0-77b4-4210-bcbd-4a93c78efb47", "historyId": "10840acb5890933de0a4dba81b3cae36", "testCaseId": "10840acb5890933de0a4dba81b3cae36", "fullName": "test_vps.test_vps_masOrderSend.TestVPStradingOrders6#test_dbquery_addsalve_orderSendclose", "labels": [{"name": "feature", "value": "VPS策略账号交易下单-开仓的场景校验"}, {"name": "story", "value": "场景6：复制下单-手数0.1-1，总订单5-停止功能"}, {"name": "tag", "value": "@pytest.mark.usefixtures('class_random_str')"}, {"name": "tag", "value": "flaky(reruns=0, reruns_delay=0)"}, {"name": "parentSuite", "value": "test_vps"}, {"name": "suite", "value": "test_vps_masOrderSend"}, {"name": "subSuite", "value": "TestVPSMasOrdersend"}, {"name": "host", "value": "DESKTOP-4S9CU1E"}, {"name": "thread", "value": "75628-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_vps.test_vps_masOrderSend"}]}